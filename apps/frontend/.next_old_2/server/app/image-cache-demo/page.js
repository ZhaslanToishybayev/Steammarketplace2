(()=>{var e={};e.id=967,e.ids=[967],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},7480:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c});var s=a(7096),r=a(6132),i=a(7284),n=a.n(i),l=a(2564),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let c=["",{children:["image-cache-demo",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6790)),"/home/zhaslan/Downloads/Telegram Desktop/Steammarketplace2-main (2)/Steammarketplace2-main/apps/frontend/src/app/image-cache-demo/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,769)),"/home/zhaslan/Downloads/Telegram Desktop/Steammarketplace2-main (2)/Steammarketplace2-main/apps/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/home/zhaslan/Downloads/Telegram Desktop/Steammarketplace2-main (2)/Steammarketplace2-main/apps/frontend/src/app/image-cache-demo/page.tsx"],m="/image-cache-demo/page",h={require:a,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/image-cache-demo/page",pathname:"/image-cache-demo",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7640:(e,t,a)=>{Promise.resolve().then(a.bind(a,8187))},8187:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(3854),r=a(4218),i=a(3237);function n({item:e,isSelected:t=!1,onSelect:a,onDeselect:n,size:l="md"}){let[o,c]=(0,r.useState)(t);(0,r.useEffect)(()=>{c(t)},[t]);let d=()=>{let t=!o;c(t),t?a?.(e.id):n?.(e.id)},m={sm:64,md:96,lg:128};return(0,s.jsxs)("div",{className:`
        group relative bg-gradient-to-b from-gray-900 to-black
        border border-gray-800 hover:border-blue-500
        rounded-xl transition-all duration-300 cursor-pointer
        transform hover:scale-[1.02] hover:shadow-2xl
        ${o?"ring-2 ring-blue-500 ring-offset-2 ring-offset-black":""}
        ${{sm:"p-2",md:"p-3",lg:"p-4"}[l]}
      `,onClick:d,role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&d()},children:[s.jsx("div",{className:"absolute inset-0 rounded-xl",children:s.jsx("div",{className:`
            absolute top-2 right-2 w-6 h-6 rounded-full border-2
            ${o?"bg-blue-500 border-blue-300":"bg-gray-700 border-gray-500"}
            transition-all duration-200
          `,children:o&&s.jsx("svg",{className:"w-4 h-4 text-white mt-1 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),(0,s.jsxs)("div",{className:"aspect-square relative mb-3",children:[s.jsx(i.w,{src:(e=>{if(!e)return"";let t=e.replace("https://steamcommunity-a.akamaihd.net/economy/image/",""),a=`https://steamcommunity-a.akamaihd.net/economy/image/${encodeURIComponent(t)}/128fx`;return a})(e.icon_url),alt:e.name,width:m[l],height:m[l],className:"w-full h-full object-contain rounded-lg group-hover:brightness-110 transition-all duration-300",placeholder:"Loading image...",fallback:"https://via.placeholder.com/256",onLoad:()=>console.log(`ðŸ“¦ Image loaded: ${e.name}`),onError:()=>console.error(`âŒ Failed to load image: ${e.name}`)}),e.amount>1&&s.jsx("div",{className:"absolute -top-2 -right-2 bg-blue-600 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center shadow-lg",children:e.amount}),(0,s.jsxs)("div",{className:"absolute bottom-2 left-2 flex space-x-1",children:[e.tradable&&s.jsx("span",{className:"bg-green-500/20 text-green-400 text-xs px-2 py-1 rounded-full",children:"Tradeable"}),e.marketable&&s.jsx("span",{className:"bg-blue-500/20 text-blue-400 text-xs px-2 py-1 rounded-full",children:"Marketable"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("h3",{className:`
            font-semibold text-white truncate
            ${"lg"===l?"text-lg":"md"===l?"text-base":"text-sm"}
          `,title:e.name,children:e.name}),s.jsx("p",{className:`
            text-gray-400 truncate
            ${"lg"===l?"text-sm":"text-xs"}
          `,title:e.market_hash_name,children:e.market_hash_name}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`
              text-xs text-gray-500 truncate
              ${"lg"===l?"text-sm":"text-xs"}
            `,children:(()=>{let t=e?.descriptions||[],a=e=>t.find(t=>String(t.type||"").toLowerCase().includes(e))?.value,s=a("type")||e.type,r=a("rarity"),i=a("exterior")||a("quality");return[r,i,s].filter(Boolean).join(" â€¢ ")})()||"Item"}),(0,s.jsxs)("div",{className:"flex space-x-1",children:[e.tradable&&s.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"T"}),e.marketable&&s.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-400 px-2 py-1 rounded",children:"M"})]})]}),(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none",children:[s.jsx("div",{className:"p-4 h-full flex flex-col justify-between",children:(0,s.jsxs)("div",{className:"text-xs text-gray-300 space-y-1",children:[(0,s.jsxs)("div",{children:["ClassID: ",e.classid]}),(0,s.jsxs)("div",{children:["InstanceID: ",e.instanceid]}),(0,s.jsxs)("div",{children:["Type: ",e.type]})]})}),(0,s.jsxs)("div",{className:"text-center flex gap-2 justify-center",children:[s.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition",children:o?"Selected":"Select"}),e.inspect_link&&s.jsx("a",{href:`https://csgo.gallery/${e.inspect_link}`,target:"_blank",rel:"noopener noreferrer",className:"bg-gray-700 hover:bg-gray-600 text-white p-1.5 rounded transition",title:"View Screenshot",onClick:e=>e.stopPropagation(),children:"\uD83D\uDCF8"})]})]})]}),e.stickers&&e.stickers.length>0&&s.jsx("div",{className:"absolute bottom-8 right-2 flex -space-x-2",children:e.stickers.map((e,t)=>s.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-900 border border-gray-700 flex items-center justify-center overflow-hidden",title:e,children:s.jsx("span",{className:"text-[8px] text-gray-400",children:"â˜…"})},t))}),void 0!==e.float_value&&s.jsx("div",{className:"absolute top-2 left-2 bg-black/60 rounded px-1.5 py-0.5 backdrop-blur-md border border-gray-700",children:s.jsx("span",{className:"text-[10px] text-gray-300 font-mono",children:e.float_value.toFixed(4)})}),s.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-br from-transparent via-blue-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})}function l(){let[e,t]=(0,r.useState)([]),{stats:a,refreshStats:l,clearCache:o,preloadImage:c}=(0,i.K)(),{selectedItems:d,selectItem:m,deselectItem:h,clearSelection:u}=(0,i.useSelectedItems)(),x=[{id:"1",name:"AK-47 | Redline",icon_url:"https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxH5ZdgJ5IO4y0XhJ0LQFtqDiVc1dozJYx1hHI3uXCxhHKonOCMKKTdHBxvgulC5hQJ2kZ0O6b8u6jxMzJiOvuI5fYl7dVhslcPDvcqZO83FL5tBm0p4e8V8ZdJcH2N1aImFq0q5OZnW7xP1f8j7u9l1nDc7bqkF86tO6dkjwJvOa9Cii59Nf8K4K6bDiikbP9ZwJkqTq3CwqzO865LQ/256fx256f",type:"Rifle",tradable:!0,marketable:!0,amount:1},{id:"2",name:"M4A1-S | Blueprint",icon_url:"https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxH5ZdgJ5IO4y0XhJ0LQFtqDiVc1dozJYx1hHI3uXCxhHKonOCMKKTdHBxvgulC5hQJ2kZ0O6b8u6jxMzJiOvuI5fYl7dVhslcPDvcqZO83FL5tBm0p4e8V8ZdJcH2N1aImFq0q5OZnW7xP1f8j7u9l1nDc7bqkF86tO6dkjwJvOa9Cii59Nf8K4K6bDiikbP9ZwJkqTq3CwqzO865LQ/256fx256f",type:"Rifle",tradable:!0,marketable:!0,amount:2},{id:"3",name:"AWP | Dragon Lore",icon_url:"https://steamcommunity-a.akamaihd.net/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxH5ZdgJ5IO4y0XhJ0LQFtqDiVc1dozJYx1hHI3uXCxhHKonOCMKKTdHBxvgulC5hQJ2kZ0O6b8u6jxMzJiOvuI5fYl7dVhslcPDvcqZO83FL5tBm0p4e8V8ZdJcH2N1aImFq0q5OZnW7xP1f8j7u9l1nDc7bqkF86tO6dkjwJvOa9Cii59Nf8K4K6bDiikbP9ZwJkqTq3CwqzO865LQ/256fx256f",type:"Sniper",tradable:!1,marketable:!0,amount:1}];(0,r.useEffect)(()=>{l()},[]);let g=async()=>{for(let e of x)await c(e.icon_url);l()},p=async()=>{o(),u()};return(0,s.jsxs)("div",{className:"min-h-screen bg-black",children:[s.jsx("header",{className:"border-b border-gray-800",children:s.jsx("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Image Cache Demo"}),s.jsx("span",{className:"text-gray-400",children:"IndexedDB + Lazy Loading"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[s.jsx("button",{onClick:g,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition",children:"\uD83D\uDCE6 Preload All Images"}),s.jsx("button",{onClick:()=>l(),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition",children:"\uD83D\uDD04 Refresh Stats"}),s.jsx("button",{onClick:p,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition",children:"\uD83D\uDDD1ï¸ Clear All Caches"})]})]})})}),(0,s.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-black border border-gray-800 rounded-2xl p-6 mb-8",children:[s.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Image Cache Statistics"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:a.count}),s.jsx("div",{className:"text-gray-400 text-sm",children:"Cached Images"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-white",children:[(a.totalSize/1024/1024).toFixed(2)," MB"]}),s.jsx("div",{className:"text-gray-400 text-sm",children:"Total Size"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-white",children:[a.oldestImage?Math.floor((Date.now()-a.oldestImage)/1e3/60):0," min"]}),s.jsx("div",{className:"text-gray-400 text-sm",children:"Oldest Image"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-white",children:[a.newestImage?Math.floor((Date.now()-a.newestImage)/1e3/60):0," min"]}),s.jsx("div",{className:"text-gray-400 text-sm",children:"Newest Image"})]})]})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-black border border-gray-800 rounded-2xl p-6 mb-8",children:[s.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Demo Images"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:x.map(e=>(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx(n,{item:e,isSelected:d.includes(e.id),onSelect:m,onDeselect:h}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(i.w,{src:e.icon_url,alt:e.name,width:128,height:128,className:"rounded-lg border border-gray-700",placeholder:"Loading...",fallback:"https://via.placeholder.com/128",onLoad:()=>console.log(`ðŸ“¦ Image loaded: ${e.name}`),onError:()=>console.error(`âŒ Failed to load: ${e.name}`)}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:"text-gray-400",children:e.name}),s.jsx("button",{onClick:()=>c(e.icon_url),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs transition",children:"\uD83D\uDCE6 Cache"})]})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-gray-900 to-black border border-gray-800 rounded-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-white",children:"Selected Items"}),s.jsx("button",{onClick:u,className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition",children:"Clear Selection"})]}),0===d.length?s.jsx("div",{className:"text-center text-gray-400 py-8",children:"No items selected. Click on cards to select them."}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:x.filter(e=>d.includes(e.id)).map(e=>(0,s.jsxs)("div",{className:"border border-gray-700 rounded-lg p-4",children:[s.jsx("div",{className:"text-white font-semibold",children:e.name}),s.jsx("div",{className:"text-gray-400 text-sm",children:e.type}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-green-400",children:[e.tradable?"âœ… Tradable":"âŒ Not Tradable"," â€¢",e.marketable?" âœ… Marketable":" âŒ Not Marketable"]})]},e.id))})]}),(0,s.jsxs)("div",{className:"mt-8 bg-gradient-to-br from-blue-900/20 to-black border border-blue-800/30 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:"How Image Caching Works"}),(0,s.jsxs)("ul",{className:"text-gray-400 space-y-1 text-sm",children:[s.jsx("li",{children:"â€¢ Images are automatically cached in IndexedDB after first load"}),s.jsx("li",{children:"â€¢ Cached images are served instantly on subsequent visits"}),s.jsx("li",{children:"â€¢ TTL: 24 hours (configurable)"}),s.jsx("li",{children:"â€¢ Max cache size: 100 MB (auto cleanup)"}),s.jsx("li",{children:"â€¢ Lazy loading with Intersection Observer"}),s.jsx("li",{children:"â€¢ Automatic fallback for failed loads"})]})]})]})]})}},3237:(e,t,a)=>{"use strict";a.d(t,{K:()=>l,w:()=>n});var s=a(3854),r=a(4218),i=a(9638);function n({src:e,alt:t,className:a,placeholder:n,fallback:l,width:o,height:c,style:d,onLoad:m,onError:h,priority:u=!1}){let[x,g]=(0,r.useState)(null),[p,b]=(0,r.useState)(!u),[f,y]=(0,r.useState)(!1),j=(0,r.useRef)(null),v=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=!0,a=async()=>{if(e)try{let a=await i.U.getImage(e);if(a){if(!t)return;g(a),b(!1),m?.();return}await w(e)}catch(e){if(console.error("Image loading failed:",e),!t)return;y(!0),b(!1),h?.()}};if(u)a();else{let e=new IntersectionObserver(async t=>{t[0].isIntersecting&&(a(),e.disconnect())},{rootMargin:"50px 0px",threshold:.01});return v.current&&e.observe(v.current),()=>e.disconnect()}return()=>{t=!1}},[e,u,m,h]);let w=async e=>{if(e)return new Promise((t,a)=>{let s=new Image;s.crossOrigin="anonymous",s.onload=async()=>{try{let a=document.createElement("canvas");a.width=s.width,a.height=s.height;let r=a.getContext("2d");r?.drawImage(s,0,0);let n=a.toDataURL("image/png");await i.U.setImage(e,n),g(n),b(!1),m?.(),t()}catch(e){console.error("Failed to cache image:",e),a(e)}},s.onerror=()=>{console.error("Failed to load image:",e),y(!0),b(!1),h?.(),a(Error("Image loading failed"))},s.src=e})},N=()=>{y(!0),b(!1),h?.()};return(0,s.jsxs)("div",{ref:v,className:`relative ${a||""}`,style:d,"aria-busy":p,children:[p&&s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-800 to-gray-900 animate-pulse",style:{width:o,height:c},children:n&&s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("span",{className:"text-gray-500 text-sm",children:n})})}),f&&!l&&s.jsx("div",{className:"absolute inset-0 bg-gray-800 flex items-center justify-center",style:{width:o,height:c},children:s.jsx("span",{className:"text-gray-400 text-sm",children:"Failed to load"})}),f&&l?s.jsx("img",{ref:j,src:l,alt:t,className:a,width:o,height:c,style:d,onError:N}):x?s.jsx("img",{ref:j,src:x,alt:t,className:a,width:o,height:c,style:d,onLoad:()=>b(!1),onError:N}):null,p&&s.jsx("div",{className:"absolute top-2 right-2",children:s.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-blue-500 rounded-full animate-spin"})}),x&&!p&&s.jsx("div",{className:"absolute top-2 left-2",children:s.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded",children:"\uD83D\uDCE6 Cached"})})]})}function l(){let[e,t]=(0,r.useState)({count:0,totalSize:0,oldestImage:0,newestImage:0}),a=async()=>{let e=await i.U.getStats();t(e)},s=async()=>{await i.U.clear(),await a()},n=async e=>{if(e)try{let t=await i.U.hasImage(e);if(t)return;let a=new Image;return a.crossOrigin="anonymous",new Promise((t,s)=>{a.onload=async()=>{try{let s=document.createElement("canvas");s.width=a.width,s.height=a.height;let r=s.getContext("2d");r?.drawImage(a,0,0);let n=s.toDataURL("image/png");await i.U.setImage(e,n),t()}catch(e){s(e)}},a.onerror=()=>s(Error("Failed to preload image")),a.src=e})}catch(e){console.error("Failed to preload image:",e)}};return(0,r.useEffect)(()=>{a();let e=setInterval(a,5e3);return()=>clearInterval(e)},[]),{stats:e,refreshStats:a,clearCache:s,preloadImage:n}}},9638:(e,t,a)=>{"use strict";a.d(t,{U:()=>i});let s={defaultTTL:864e5,maxSize:100,cleanupInterval:36e5};class r{constructor(e={}){this.dbName="steam-images",this.storeName="images",this.version=1,this.dbPromise=null,this.cleanupTimer=null,this.isClient=!1,this.config={...s,...e},this.isClient=!1,this.isClient&&(this.initDB(),this.startCleanupTimer())}initDB(){this.isClient&&(this.dbPromise=new Promise((e,t)=>{if("undefined"==typeof indexedDB)return;let a=indexedDB.open(this.dbName,this.version);a.onerror=()=>t(a.error),a.onsuccess=()=>e(a.result),a.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"url"});e.createIndex("timestamp","timestamp",{unique:!1})}}}))}async hasImage(e){if(!this.dbPromise)return!1;try{let t=await this.getImageEntry(e);if(!t)return!1;return Date.now()-t.timestamp<t.ttl}catch{return!1}}async getImage(e){if(!this.dbPromise)return null;try{let t=await this.getImageEntry(e);if(!t)return null;let a=Date.now();if(a-t.timestamp>=t.ttl)return await this.removeImage(e),null;return t.data}catch{return null}}async setImage(e,t,a){if(this.dbPromise)try{let s={url:e,data:t,timestamp:Date.now(),ttl:a||this.config.defaultTTL},r=await this.dbPromise,i=r.transaction([this.storeName],"readwrite"),n=i.objectStore(this.storeName);n.put(s),await this.checkAndCleanupSize()}catch(e){console.error("Failed to cache image:",e)}}async removeImage(e){if(this.dbPromise)try{let t=await this.dbPromise,a=t.transaction([this.storeName],"readwrite"),s=a.objectStore(this.storeName);s.delete(e)}catch(e){console.error("Failed to remove image from cache:",e)}}async clear(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),a=t.objectStore(this.storeName);a.clear()}catch(e){console.error("Failed to clear image cache:",e)}}async getStats(){if(!this.dbPromise)return{count:0,totalSize:0,oldestImage:0,newestImage:0};try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readonly"),a=t.objectStore(this.storeName),s=a.getAll();return new Promise(e=>{s.onsuccess=()=>{let t=s.result,a=t.length,r=t.reduce((e,t)=>e+t.data.length,0),i=t.length?Math.min(...t.map(e=>e.timestamp)):0,n=t.length?Math.max(...t.map(e=>e.timestamp)):0;e({count:a,totalSize:r,oldestImage:i,newestImage:n})}})}catch{return{count:0,totalSize:0,oldestImage:0,newestImage:0}}}async getImageEntry(e){if(!this.dbPromise)return null;let t=await this.dbPromise,a=t.transaction([this.storeName],"readonly"),s=a.objectStore(this.storeName),r=s.get(e);return new Promise(e=>{r.onsuccess=()=>e(r.result),r.onerror=()=>e(null)})}async checkAndCleanupSize(){if(this.dbPromise)try{let e=await this.getStats(),t=e.totalSize/1048576;t>this.config.maxSize&&await this.cleanupOldestEntries()}catch(e){console.error("Failed to check cache size:",e)}}async cleanupOldestEntries(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),a=t.objectStore(this.storeName),s=a.index("timestamp"),r=s.openCursor(),i=0,n=.8*this.config.maxSize;r.onsuccess=async e=>{let t=e.target.result;if(!t)return;await this.removeImage(t.key),i++;let a=await this.getStats(),s=a.totalSize/1048576;s>n&&i<100&&t.continue()}}catch(e){console.error("Failed to cleanup oldest entries:",e)}}startCleanupTimer(){this.isClient&&(this.cleanupTimer&&clearInterval(this.cleanupTimer),this.cleanupTimer=setInterval(async()=>{this.dbPromise&&(await this.cleanupExpired(),await this.checkAndCleanupSize())},this.config.cleanupInterval),console.log(`ðŸ§¹ Image cache cleanup timer started (interval: ${this.config.cleanupInterval}ms)`))}async cleanupExpired(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),a=t.objectStore(this.storeName),s=a.index("timestamp"),r=s.openCursor(),i=0,n=Date.now();r.onsuccess=async e=>{let t=e.target.result;if(!t)return;let a=t.value;n-a.timestamp>=a.ttl&&(await this.removeImage(a.url),i++,t.continue())}}catch(e){console.error("Failed to cleanup expired entries:",e)}}stopCleanupTimer(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}}let i=new r({defaultTTL:864e5,maxSize:100,cleanupInterval:36e5})},6790:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>o});var s=a(5153);let r=(0,s.createProxy)(String.raw`/home/zhaslan/Downloads/Telegram Desktop/Steammarketplace2-main (2)/Steammarketplace2-main/apps/frontend/src/app/image-cache-demo/page.tsx`),{__esModule:i,$$typeof:n}=r,l=r.default,o=l}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[581,919],()=>a(7480));module.exports=s})();