"use strict";exports.id=300,exports.ids=[300],exports.modules={9638:(e,t,r)=>{r.d(t,{U:()=>i});let a={defaultTTL:864e5,maxSize:100,cleanupInterval:36e5};class s{constructor(e={}){this.dbName="steam-images",this.storeName="images",this.version=1,this.dbPromise=null,this.cleanupTimer=null,this.isClient=!1,this.config={...a,...e},this.isClient=!1,this.isClient&&(this.initDB(),this.startCleanupTimer())}initDB(){this.isClient&&(this.dbPromise=new Promise((e,t)=>{if("undefined"==typeof indexedDB)return;let r=indexedDB.open(this.dbName,this.version);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){let e=t.createObjectStore(this.storeName,{keyPath:"url"});e.createIndex("timestamp","timestamp",{unique:!1})}}}))}async hasImage(e){if(!this.dbPromise)return!1;try{let t=await this.getImageEntry(e);if(!t)return!1;return Date.now()-t.timestamp<t.ttl}catch{return!1}}async getImage(e){if(!this.dbPromise)return null;try{let t=await this.getImageEntry(e);if(!t)return null;let r=Date.now();if(r-t.timestamp>=t.ttl)return await this.removeImage(e),null;return t.data}catch{return null}}async setImage(e,t,r){if(this.dbPromise)try{let a={url:e,data:t,timestamp:Date.now(),ttl:r||this.config.defaultTTL},s=await this.dbPromise,i=s.transaction([this.storeName],"readwrite"),o=i.objectStore(this.storeName);o.put(a),await this.checkAndCleanupSize()}catch(e){console.error("Failed to cache image:",e)}}async removeImage(e){if(this.dbPromise)try{let t=await this.dbPromise,r=t.transaction([this.storeName],"readwrite"),a=r.objectStore(this.storeName);a.delete(e)}catch(e){console.error("Failed to remove image from cache:",e)}}async clear(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName);r.clear()}catch(e){console.error("Failed to clear image cache:",e)}}async getStats(){if(!this.dbPromise)return{count:0,totalSize:0,oldestImage:0,newestImage:0};try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readonly"),r=t.objectStore(this.storeName),a=r.getAll();return new Promise(e=>{a.onsuccess=()=>{let t=a.result,r=t.length,s=t.reduce((e,t)=>e+t.data.length,0),i=t.length?Math.min(...t.map(e=>e.timestamp)):0,o=t.length?Math.max(...t.map(e=>e.timestamp)):0;e({count:r,totalSize:s,oldestImage:i,newestImage:o})}})}catch{return{count:0,totalSize:0,oldestImage:0,newestImage:0}}}async getImageEntry(e){if(!this.dbPromise)return null;let t=await this.dbPromise,r=t.transaction([this.storeName],"readonly"),a=r.objectStore(this.storeName),s=a.get(e);return new Promise(e=>{s.onsuccess=()=>e(s.result),s.onerror=()=>e(null)})}async checkAndCleanupSize(){if(this.dbPromise)try{let e=await this.getStats(),t=e.totalSize/1048576;t>this.config.maxSize&&await this.cleanupOldestEntries()}catch(e){console.error("Failed to check cache size:",e)}}async cleanupOldestEntries(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName),a=r.index("timestamp"),s=a.openCursor(),i=0,o=.8*this.config.maxSize;s.onsuccess=async e=>{let t=e.target.result;if(!t)return;await this.removeImage(t.key),i++;let r=await this.getStats(),a=r.totalSize/1048576;a>o&&i<100&&t.continue()}}catch(e){console.error("Failed to cleanup oldest entries:",e)}}startCleanupTimer(){this.isClient&&(this.cleanupTimer&&clearInterval(this.cleanupTimer),this.cleanupTimer=setInterval(async()=>{this.dbPromise&&(await this.cleanupExpired(),await this.checkAndCleanupSize())},this.config.cleanupInterval),console.log(`ðŸ§¹ Image cache cleanup timer started (interval: ${this.config.cleanupInterval}ms)`))}async cleanupExpired(){if(this.dbPromise)try{let e=await this.dbPromise,t=e.transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName),a=r.index("timestamp"),s=a.openCursor(),i=0,o=Date.now();s.onsuccess=async e=>{let t=e.target.result;if(!t)return;let r=t.value;o-r.timestamp>=r.ttl&&(await this.removeImage(r.url),i++,t.continue())}}catch(e){console.error("Failed to cleanup expired entries:",e)}}stopCleanupTimer(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}}let i=new s({defaultTTL:864e5,maxSize:100,cleanupInterval:36e5})},9543:(e,t,r)=>{r.d(t,{z:()=>i});let a={defaultTTL:3e5,maxCacheSize:50,cleanupInterval:6e4};class s{constructor(e={}){this.cache=new Map,this.cleanupTimer=null,this.config={...a,...e},this.startCleanupTimer()}generateKey(e,t,r){let a=r?`:${r}`:"";return`inventory:${e}:${t}${a}`}isEntryValid(e){let t=Date.now();return t-e.timestamp<e.ttl}getInventory(e,t,r){let a=this.generateKey(e,t,r),s=this.cache.get(a);return s?this.isEntryValid(s)?(console.log(`ðŸ“¦ Cache HIT for ${a}`),s.data):(console.log(`ðŸ“¦ Cache EXPIRED for ${a}`),this.cache.delete(a),null):(console.log(`ðŸ“¦ Cache MISS for ${a}`),null)}setInventory(e,t,r,a,s){let i=this.generateKey(e,t,s),o=a||this.config.defaultTTL,n={data:r,timestamp:Date.now(),ttl:o};this.cache.size>=this.config.maxCacheSize&&this.evictOldest(),this.cache.set(i,n),console.log(`ðŸ“¦ Cache SET for ${i} (TTL: ${o}ms)`)}evictOldest(){let e=null,t=Date.now();for(let[r,a]of this.cache.entries())a.timestamp<t&&(t=a.timestamp,e=r);e&&(this.cache.delete(e),console.log(`ðŸ“¦ Evicted oldest cache entry: ${e}`))}invalidateInventory(e,t,r){let a=this.generateKey(e,t,r);this.cache.has(a)&&(this.cache.delete(a),console.log(`ðŸ“¦ Cache INVALIDATED for ${a}`))}invalidateUser(e){let t=[];for(let r of this.cache.keys())r.startsWith(`inventory:${e}:`)&&t.push(r);t.forEach(e=>this.cache.delete(e)),console.log(`ðŸ“¦ Invalidated ${t.length} cache entries for user ${e}`)}clear(){this.cache.clear(),console.log(`ðŸ“¦ Cache CLEARED`)}getStats(){let e={size:this.cache.size,maxSize:this.config.maxCacheSize,entries:[]},t=Date.now();for(let[r,a]of this.cache.entries())e.entries.push({key:r,age:t-a.timestamp,ttl:a.ttl,valid:this.isEntryValid(a)});return e}startCleanupTimer(){this.cleanupTimer&&clearInterval(this.cleanupTimer),this.cleanupTimer=setInterval(()=>{this.cleanup()},this.config.cleanupInterval),console.log(`ðŸ§¹ Cleanup timer started (interval: ${this.config.cleanupInterval}ms)`)}stopCleanupTimer(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null,console.log(`ðŸ§¹ Cleanup timer stopped`))}cleanup(){this.cache.size;let e=Date.now(),t=[];for(let[r,a]of this.cache.entries())e-a.timestamp>=a.ttl&&t.push(r);if(t.forEach(e=>this.cache.delete(e)),t.length>0&&console.log(`ðŸ§¹ Cleaned up ${t.length} expired cache entries`),this.cache.size>this.config.maxCacheSize){let e=this.cache.size-this.config.maxCacheSize;for(let t=0;t<e;t++)this.evictOldest();console.log(`ðŸ§¹ Evicted ${e} oldest entries due to size limit`)}}saveToStorage(){try{let e=JSON.stringify({cache:Array.from(this.cache.entries()),timestamp:Date.now()});localStorage.setItem("inventory_cache",e),console.log(`ðŸ’¾ Cache saved to localStorage (${this.cache.size} entries)`)}catch(e){console.error(`ðŸ’¾ Failed to save cache to localStorage:`,e)}}loadFromStorage(){try{let e=localStorage.getItem("inventory_cache");if(!e)return;let t=JSON.parse(e),r=t.cache,a=Date.now(),s=0;for(let[e,t]of r)a-t.timestamp<t.ttl&&(this.cache.set(e,t),s++);console.log(`ðŸ’¾ Loaded ${s} valid cache entries from localStorage`)}catch(e){console.error(`ðŸ’¾ Failed to load cache from localStorage:`,e)}}hasRecentCache(e,t,r){let a=this.generateKey(e,t,r),s=this.cache.get(a);return!!s&&this.isEntryValid(s)}getCacheAge(e,t,r){let a=this.generateKey(e,t,r),s=this.cache.get(a);return s?Date.now()-s.timestamp:-1}initPageUnloadHandler(){}}let i=new s({defaultTTL:3e5,maxCacheSize:50,cleanupInterval:6e4});i.initPageUnloadHandler()},8300:(e,t,r)=>{r.d(t,{Xq:()=>u,Qs:()=>f,b3:()=>h,h2:()=>m});var a=r(4218),s=r(2828),i=r(9543),o=r(9638);class n{async prefetchUserData(e,t={},r){let a={dotaInventory:!0,cs2Inventory:!0,itemImages:!0,userProfile:!0,marketPrices:!1,...t},s={success:!1,completed:[],failed:[],timing:{}},i=[{key:"dotaInventory",fn:()=>this.prefetchDotaInventory(e)},{key:"cs2Inventory",fn:()=>this.prefetchCs2Inventory(e)},{key:"userProfile",fn:()=>this.prefetchUserProfile(e)},{key:"itemImages",fn:()=>this.prefetchPopularItemImages()},{key:"marketPrices",fn:()=>this.prefetchMarketPrices()}].filter(e=>a[e.key]),o=i.length,n=0;console.log(`ðŸš€ Starting prefetching for ${o} tasks`);let c=i.map(async t=>{let a=Date.now(),i=`${t.key}-${e}`;try{if(this.activePrefetches.has(i))return console.log(`â³ ${t.key} already being prefetched`),{key:t.key,success:!0,time:0};this.activePrefetches.add(i);let e=new AbortController;this.abortControllers.set(i,e),console.log(`ðŸ“¦ Starting prefetch: ${t.key}`),await t.fn();let c=Date.now()-a;return s.timing[t.key]=c,s.completed.push(t.key),console.log(`âœ… Prefetch completed: ${t.key} (${c}ms)`),r?.(++n/o,t.key),{key:t.key,success:!0,time:c}}catch(i){let e=Date.now()-a;return s.timing[t.key]=e,s.failed.push(t.key),console.warn(`âŒ Prefetch failed: ${t.key}`,i),r?.(++n/o,t.key),{key:t.key,success:!1,time:e}}finally{this.activePrefetches.delete(`${t.key}-${e}`),this.abortControllers.delete(i)}});await Promise.all(c);let l=0===s.failed.length;return s.success=l,console.log(`ðŸŽ¯ Prefetching completed: ${l?"SUCCESS":"PARTIAL"}`,{completed:s.completed,failed:s.failed,timing:s.timing}),s}async prefetchDotaInventory(e){console.log("\uD83D\uDCE6 Prefetching Dota 2 inventory...");try{let{items:t}=await s.x.fetchInventory(e,570,{forceRefresh:!1});i.z.set(e,570,t,6e5),console.log(`âœ… Dota 2 inventory prefetched: ${t.length} items`)}catch(e){throw console.error("âŒ Failed to prefetch Dota 2 inventory:",e),e}}async prefetchCs2Inventory(e){console.log("\uD83D\uDD2B Prefetching CS2 inventory...");try{let{items:t}=await s.x.fetchInventory(e,730,{forceRefresh:!1});i.z.set(e,730,t,6e5),console.log(`âœ… CS2 inventory prefetched: ${t.length} items`)}catch(e){throw console.error("âŒ Failed to prefetch CS2 inventory:",e),e}}async prefetchUserProfile(e){console.log("\uD83D\uDC64 Prefetching user profile...");try{let t=await s.x.fetchUserProfile(e);localStorage.setItem(`steam_profile_${e}`,JSON.stringify({...t,cachedAt:Date.now()})),console.log("âœ… User profile prefetched")}catch(e){throw console.error("âŒ Failed to prefetch user profile:",e),e}}async prefetchPopularItemImages(){console.log("\uD83D\uDDBCï¸ Prefetching popular item images...");let e=0,t=0;for(let r of["AWP | Dragon Lore","AK-47 | Redline","M4A4 | Howl","Desert Eagle | Hypnotic","AK-47 | Case Hardened","M4A1-S | Hyper Beast","AWP | Medusa","AK-47 | Vulcan","M4A4 | Asiimov","AWP | Safari Mesh"])try{let t=this.generateItemImageUrl(r);await o.U.preloadImage(t),e++,console.log(`âœ… Prefetched image: ${r}`)}catch(e){t++,console.warn(`âŒ Failed to prefetch image: ${r}`,e)}console.log(`ðŸ–¼ï¸ Image prefetching completed: ${e} success, ${t} failed`)}async prefetchMarketPrices(){console.log("\uD83D\uDCB0 Prefetching market prices...");try{let e={};for(let t of["AWP | Dragon Lore","AK-47 | Redline","M4A4 | Howl"])e[t]=1e3*Math.random()+100;localStorage.setItem("market_prices",JSON.stringify({prices:e,timestamp:Date.now()})),console.log("âœ… Market prices prefetched")}catch(e){throw console.error("âŒ Failed to prefetch market prices:",e),e}}generateItemImageUrl(e){return"https://steamcommunity-a.akamaihd.net/economy/image/"+(({"AWP | Dragon Lore":"fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcU7l7or8dQZTzC1p2j1T3AetWJZQohNybwxWXVUQH2x8yYQJ2G9uE9vE64xKQp783hRQ9hP9v9eDxjB2Dn-10G9vE8262428","AK-47 | Redline":"fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcU7l7or8dQZTzC1p2j1T3AetWJZQohNybwxWXVUQH2x8yYQJ2G9uE9vE64xKQp783hRQ9hP9v9eDxjB2Dn-10G9vE8262428","M4A4 | Howl":"fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcU7l7or8dQZTzC1p2j1T3AetWJZQohNybwxWXVUQH2x8yYQJ2G9uE9vE64xKQp783hRQ9hP9v9eDxjB2Dn-10G9vE8262428","Desert Eagle | Hypnotic":"fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcU7l7or8dQZTzC1p2j1T3AetWJZQohNybwxWXVUQH2x8yYQJ2G9uE9vE64xKQp783hRQ9hP9v9eDxjB2Dn-10G9vE8262428"})[e]||"placeholder")}cancelAll(){for(let[e,t]of(console.log("\uD83D\uDED1 Cancelling all active prefetches"),this.abortControllers.entries()))t.abort(),this.activePrefetches.delete(e);this.abortControllers.clear()}getStatus(){return{activePrefetches:this.activePrefetches.size,isPrefetching:this.activePrefetches.size>0}}async prefetchInventory(e,t){let r=`inventory-${e}-${t}`;if(this.activePrefetches.has(r)){console.log(`â³ Inventory already being prefetched: ${t}`);return}try{this.activePrefetches.add(r);let{items:a}=await s.x.fetchInventory(e,t,{forceRefresh:!1});i.z.set(e,t,a,6e5),console.log(`âœ… Inventory prefetched: ${t} (${a.length} items)`)}catch(e){throw console.error(`âŒ Failed to prefetch inventory: ${t}`,e),e}finally{this.activePrefetches.delete(r)}}constructor(){this.activePrefetches=new Set,this.abortControllers=new Map}}let c=new n;var l=r(931);function h(e={}){let{enabled:t=!0,onProgress:r,onSuccess:s,onError:o}=e,[n,h]=(0,a.useState)(!1),[u,f]=(0,a.useState)(0),[m,d]=(0,a.useState)(""),[g,p]=(0,a.useState)(null),[y,v]=(0,a.useState)(null),[w,P]=(0,a.useState)(!1),I=(0,a.useRef)(null),D=l.c.getUser(),S=D?.steamId,C=(0,a.useCallback)(async e=>{if(!t||!S)throw Error("Prefetching not enabled or user not authenticated");h(!0),f(0),d(""),v(null);try{let t=await c.prefetchUserData(S,e,(e,t)=>{f(e),d(t),r?.(e,t)});if(p(t),h(!1),t.success)s?.(t);else{let e=Error(`Prefetching completed with ${t.failed.length} failures`);v(e),o?.(e)}return t}catch(t){let e=t instanceof Error?t:Error("Failed to prefetch user data");throw v(e),h(!1),o?.(e),e}},[t,S,r,s,o]),b=(0,a.useCallback)(async e=>{if(!t||!S)throw Error("Prefetching not enabled or user not authenticated");h(!0),d(`inventory-${e}`);try{await c.prefetchInventory(S,e),h(!1)}catch(t){let e=t instanceof Error?t:Error("Failed to prefetch inventory");throw v(e),h(!1),e}},[t,S]),E=(0,a.useCallback)(()=>{c.cancelAll(),h(!1),f(0),d("")},[]),k=(0,a.useCallback)(()=>c.getStatus(),[]),T=(0,a.useCallback)(()=>{v(null)},[]),$=(0,a.useCallback)(e=>{if(!t||!S){console.warn("Auto-prefetching not enabled or user not authenticated");return}if(w){console.warn("Auto-prefetching already running");return}P(!0),C(e).catch(console.error),I.current=setInterval(()=>{w&&(console.log("\uD83D\uDD04 Running periodic prefetch..."),C(e).catch(e=>{console.error("Periodic prefetch failed:",e)}))},6e5),console.log("\uD83D\uDE80 Auto-prefetching started")},[t,S,w,C]),x=(0,a.useCallback)(()=>{I.current&&(clearInterval(I.current),I.current=null),P(!1),E(),console.log("\uD83D\uDED1 Auto-prefetching stopped")},[E]);(0,a.useEffect)(()=>()=>{x()},[x]);let A=(0,a.useCallback)(async()=>{if(!t||!S)return;console.log("\uD83E\uDDE0 Starting smart prefetching...");let e=z(),r={dotaInventory:e.includes(570),cs2Inventory:e.includes(730),itemImages:!0,userProfile:!0};try{await C(r)}catch(e){console.error("Smart prefetching failed:",e)}},[t,S,C]),z=(0,a.useCallback)(()=>{let e=[],t=Date.now(),r=t-36e5;try{let t=i.z.getStats();for(let[a,s]of Object.entries(t.entries||{}))if(s.timestamp>r){let t=a.match(/inventory:(\d+):(\d+)/);if(t){let r=parseInt(t[2]);e.includes(r)||e.push(r)}}}catch(e){console.error("Failed to get recently accessed games:",e)}return e},[]);return(0,a.useEffect)(()=>{t&&S&&A().catch(console.error)},[t,S,A]),{isPrefetching:n,progress:u,currentTask:m,result:g,error:y,prefetchUserData:C,prefetchInventory:b,cancelAll:E,getStatus:k,clearError:T,startAutoPrefetch:$,stopAutoPrefetch:x,isAutoPrefetching:w}}function u(){let e=h(),t=(0,a.useCallback)(async t=>{try{await e.prefetchInventory(t),console.log(`âœ… Background prefetch completed for app ${t}`)}catch(e){console.error(`âŒ Background prefetch failed for app ${t}:`,e)}},[e]),r=(0,a.useCallback)(async()=>{try{await e.prefetchUserData({userProfile:!0,dotaInventory:!1,cs2Inventory:!1,itemImages:!1}),console.log("âœ… Background profile prefetch completed")}catch(e){console.error("âŒ Background profile prefetch failed:",e)}},[e]);return{prefetchInventoryInBackground:t,prefetchProfileInBackground:r}}function f(e){let t=h(),r=(0,a.useCallback)(async()=>{try{await t.prefetchUserData(e)}catch(e){console.error("Hover prefetch failed:",e)}},[t,e]);return{onMouseEnter:r,isPrefetching:t.isPrefetching}}function m(e){let t=h();(0,a.useEffect)(()=>{let r=async()=>{if("visible"===document.visibilityState&&!t.isPrefetching)try{await t.prefetchUserData(e)}catch(e){console.error("Visibility prefetch failed:",e)}};return document.addEventListener("visibilitychange",r),()=>{document.removeEventListener("visibilitychange",r)}},[t,e])}}};