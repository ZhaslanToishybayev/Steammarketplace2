# Complete E2E Testing Environment Configuration

This file contains all the environment variables required for running the complete E2E flow test. Copy this file to `.env` and update with your actual credentials.

## Enable Live Tests (Required)

```bash
# Enable live testing mode
ENABLE_LIVE_TESTS=true
NODE_ENV=staging
```

## Application URLs

```bash
# Application URLs for live testing
LIVE_TEST_BASE_URL=http://localhost:3000
LIVE_TEST_API_URL=http://localhost:3001/api
LIVE_TEST_WS_URL=ws://localhost:3001
```

## Steam API Key

```bash
# Steam API Key (required for inventory sync and market data)
# Get your API key from: https://steamcommunity.com/dev/apikey
STEAM_API_KEY=YOUR_32_CHAR_STEAM_API_KEY_HERE
```

## Test User Credentials

```bash
# Test User Steam Account (your personal Steam account for testing)
# WARNING: Use a dedicated test account with minimal-value items
TEST_USER_STEAM_ID=76561198012345678
TEST_USER_USERNAME=testuser
TEST_USER_DISPLAY_NAME=Test User
TEST_USER_API_KEY=YOUR_USER_STEAM_API_KEY

# Trade URL for test user
# Generate at: https://steamcommunity.com/mytradeoffers/privacy
# Format: https://steamcommunity.com/tradeoffer/new/?partner=STEAM_ID&token=TRADE_TOKEN
TEST_USER_TRADE_URL=https://steamcommunity.com/tradeoffer/new/?partner=12345678&token=ABCDEFGH
```

## Test Bot Credentials

```bash
# Test Bot Steam Account (dedicated bot account for automated testing)
# WARNING: Use a dedicated test bot account with mobile authenticator
TEST_BOT_STEAM_ID=76561198087654321
TEST_BOT_USERNAME=testbot
TEST_BOT_ID=1
TEST_BOT_PASSWORD=YOUR_BOT_PASSWORD

# Bot 2FA Secrets (required for mobile authenticator)
# Generate using steam-totp or similar tool
TEST_BOT_SHARED_SECRET=YOUR_28_CHAR_SHARED_SECRET_HERE
TEST_BOT_IDENTITY_SECRET=YOUR_28_CHAR_IDENTITY_SECRET_HERE

# Bot Trade URL
# Format: https://steamcommunity.com/tradeoffer/new/?partner=STEAM_ID&token=TRADE_TOKEN
TEST_BOT_TRADE_URL=https://steamcommunity.com/tradeoffer/new/?partner=87654321&token=IJKLMNOP

# Bot API Key (if bot has one)
TEST_BOT_API_KEY=YOUR_BOT_STEAM_API_KEY
```

## Bot Encryption

```bash
# Bot credential encryption key (AES-256)
# Generate with: openssl rand -base64 32
BOT_ENCRYPTION_KEY=YOUR_32_CHAR_ENCRYPTION_KEY_HERE
```

## Database Connections

```bash
# PostgreSQL Database
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=steam_marketplace_staging
POSTGRES_USER=steam_user
POSTGRES_PASSWORD=steam_password

# MongoDB Database
MONGODB_URI=mongodb://localhost:27017/steam_marketplace_staging

# Redis Cache
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_password
REDIS_DB=0
```

## Monitoring Configuration

```bash
# Enable comprehensive monitoring
ENABLE_MONITORING=true
ENABLE_LOG_ANALYSIS=true
ENABLE_PERF_MONITORING=true
ENABLE_ERROR_TRACKING=true

# Log collection settings
LOG_ENDPOINT=http://localhost:3001/api/admin/logs
LOG_FILE=./logs/backend.log
LOG_API_TOKEN=YOUR_LOG_API_TOKEN
LOG_POLL_INTERVAL=5000

# Memory monitoring
ENABLE_MEMORY_MONITORING=true
ENABLE_NETWORK_MONITORING=true
```

## Performance Thresholds

```bash
# Performance monitoring thresholds
MAX_PAGE_LOAD_TIME=3000
MAX_API_RESPONSE_TIME=1000
MAX_TRADE_COMPLETION_TIME=300000
MAX_INVENTORY_SYNC_TIME=600000
MAX_MEMORY_USAGE=524288000
ACCEPTABLE_ERROR_RATE=5.0
```

## Reporting Configuration

```bash
# Report generation settings
REPORT_FORMAT=html,json
REPORT_OUTPUT_DIR=./tests/e2e/artifacts/reports
INCLUDE_SCREENSHOTS=true
INCLUDE_LOGS=true
INCLUDE_PERFORMANCE_METRICS=true
INCLUDE_ERROR_ANALYSIS=true
INCLUDE_SYSTEM_HEALTH=true
GENERATE_RECOMMENDATIONS=true
```

## Error Scenario Testing

```bash
# Enable comprehensive error scenario testing
ENABLE_ERROR_SCENARIOS=true
ERROR_SCENARIOS=invalid-trade-url,insufficient-balance,bot-offline,steam-api-timeout,rate-limiting,network-failure,invalid-item-selection,concurrent-trade-limit,expired-session,database-connection-loss

# Enable recovery and data loss testing
ENABLE_RECOVERY_TESTING=true
ENABLE_DATA_LOSS_TESTING=true
MOCK_API_FAILURES=true
MOCK_NETWORK_FAILURES=true
```

## Optional: Test Storage State

```bash
# Pre-authenticated state to skip Steam OAuth (recommended for CI)
# Generate with: npm run test:e2e:live:headed and save login state
TEST_STORAGE_STATE=./tests/e2e/live/.auth/user.json
```

## Optional: Debug Settings

```bash
# Verbose logging
LOG_LEVEL=debug

# Playwright debug settings
PLAYWRIGHT_DEBUG=1
DEBUG=*

# Enable trace generation
PWTRACE=on
```

## Security Notes

⚠️ **IMPORTANT SECURITY WARNINGS**:

1. **Never commit this file to version control** - it contains sensitive credentials
2. **Use dedicated test accounts only** - never use production accounts for testing
3. **Rotate credentials regularly** - change passwords and API keys periodically
4. **Monitor account activity** - watch for unusual activity on test accounts
5. **Use minimal-value items** - test accounts should only contain low-value items
6. **Enable 2FA** - ensure all test accounts have mobile authenticator enabled

## Credential Setup Instructions

### Getting Your Steam API Key
1. Visit: https://steamcommunity.com/dev/apikey
2. Sign in with your Steam account
3. Enter your website domain (or localhost for testing)
4. Copy the generated API key

### Setting Up Trade URLs
1. For User: Go to https://steamcommunity.com/mytradeoffers/privacy
2. Enable trade offers if not already enabled
3. Copy your trade URL (format: https://steamcommunity.com/tradeoffer/new/?partner=ID&token=TOKEN)
4. For Bot: Use the same format with bot's Steam ID and generated token

### Bot Account Setup
1. Create a dedicated Steam bot account
2. Enable Steam Guard Mobile Authenticator
3. Use steam-totp or similar tool to generate shared/identity secrets
4. Add bot to backend system with proper configuration

### Bot Encryption Key
Generate a secure 32-character encryption key:
```bash
openssl rand -base64 32
```

## Validation

After setting up your environment, validate the configuration:
```bash
npm run validate:env
```

This will check:
- ✅ Steam API key validity and connectivity
- ✅ Bot encryption key strength and format
- ✅ Database connection strings and credentials
- ✅ Trade URL format validation
- ✅ Required environment variables
- ✅ Port availability (3000, 3001)

## Troubleshooting

### Common Issues

1. **Steam API Key Invalid**
   - Verify the key is 32 characters long
   - Check that it's properly formatted (alphanumeric)
   - Test connectivity to Steam APIs

2. **Bot Login Failures**
   - Verify bot credentials are correct
   - Check that mobile authenticator is properly configured
   - Ensure bot has trade offers enabled

3. **Database Connection Issues**
   - Verify PostgreSQL, MongoDB, Redis are running
   - Check connection strings and credentials
   - Ensure required databases exist

4. **Trade URL Validation Errors**
   - Verify URL format matches Steam requirements
   - Check that Steam IDs are 17-19 digits
   - Ensure trade tokens are properly formatted

### Debug Mode

Enable verbose logging for troubleshooting:
```bash
export DEBUG=*
export LOG_LEVEL=debug
export ENABLE_MONITORING=true
```

### Test Account Recommendations

**Test User Account:**
- Use a secondary Steam account
- Add minimal-value items (under $1 each)
- Enable trade offers
- Set up mobile authenticator

**Test Bot Account:**
- Use a dedicated bot account
- Configure with mobile authenticator
- Add to backend system properly
- Test with small-value trades initially

## Reset Instructions

If you need to reset test data:
```bash
# Clean up test data
npm run test:e2e:cleanup

# Re-seed with fresh test data
npm run test:e2e:seed
```

Remember to always use dedicated test accounts and never run live tests against production systems.